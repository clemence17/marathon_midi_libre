<!DOCTYPE html>
<html>
	<head>
		<title>Leaflet</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<link rel="stylesheet" href="leaflet/leaflet.css" />
		<script src="leaflet/leaflet.js"></script>
		<script src="jquery.js"></script>
		<script src="https://d3js.org/d3.v7.min.js"></script>
	</head>
	<body>

		<div id="divmap" style="width:900px;height:500px;border:3px;border-color:gray">

		</div>

		<script type="text/javascript">



		var map = L.map('divmap');
		map.setView([46.2276, 2.2137], 5);
		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png') .addTo(map);


		var a=[];
		a.push(d3.csv("2017_2tour_region.csv"));
		Promise.all(a).then(function(values){
			const csv = values;
			console.log(values[0]);
		})

		$.ajax({
		 url: "2017_2tour_region.csv",
		 dataType: "text",
		 success: function(tour){

		 }
	 });


		$.ajax({
		 url: "regions.geojson",
		 dataType: "json",
		 success: function(regions){
			 L.geoJson(regions, { style: function(feature){
				 var fc;
				 if ( tour["Libelle_de_la_region"] > 80 )
					 fc = "#006837";
				 else if ( feature.properties.density > 40 )
					 fc = "#31a354";
				 else if ( feature.properties.density > 20 )
					 fc = "#78c679";
				 else if ( feature.properties.density > 10 )
					 fc = "#c2e699";
				 else if ( feature.properties.density > 0 )
					 fc = "#ffffcc";
				 else
					 fc = "#f7f7f7";
				 return { color: "#999999",
				 weight: 1,
				 fillColor: fc,
				 fillOpacity: 0.6};
			 },
			 onEachFeature: function( feature, layer ){
				 layer.bindPopup("<img src='macron.jpg' alt='Macron'>"  + "<strong>"+feature.properties.Name+"</strong>" + "<br />" + feature.properties.density + " rats par mètre carré" )}}).addTo(map);
		 }
	 });


		</script>



	</body>
</html>
